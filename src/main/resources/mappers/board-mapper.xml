<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Board">
    <!-- (to, from) 페이징 게시글 목록 게시 순서대로 select (검색을 위한 필터 설정 - title, writer) -->
    <select id="getList" resultType="com.kedu.newboard.dto.BoardDTO">
        SELECT * FROM (SELECT ROWNUM rm, b.* FROM board b
        <if test="searchQuery != null and searchQuery != ''">
            WHERE
            title like '%'||#{searchQuery}||'%' OR
            writer like '%'||#{searchQuery}||'%' OR
            contents like '%'||#{searchQuery}||'%'
        </if>
        ORDER BY create_at)
        WHERE rm BETWEEN #{from} #{to}
    </select>

    <!-- 선택된 게시글의 내용 select -->
    <select id="getById" resultType="com.kedu.newboard.dto.BoardDTO">
        SELECT * FROM board WHERE id = #{id}
    </select>

    <!-- 총 게시물의 갯수 조회 -->
    <select id="getBoardCount" resultType="Long">
        SELECT count(*) FROM board
        <if test="searchQuery != null and searchQuery != ''">
            WHERE
            title like '%'||#{searchQuery}||'%' OR
            writer like '%'||#{searchQuery}||'%' OR
            contents like '%'||#{searchQuery}||'%'
        </if>
    </select>

    <!-- 게시글 등록 -->
    <insert id="posting">
        INSERT INTO board(id, writer, title, contents)
        VALUES (board_seq.nextval, #{writer}, #{title}, #{contents})
    </insert>

    <!-- 게시글 삭제 -->
    <delete id="deleteById">
        DELETE FROM board WHERE id = #{id}
    </delete>

    <!-- 게시글 수정(제목, 내용만 수정 가능) -->
    <update id="updateById">
        UPDATE board SET title = #{title}, contents = #{contents} WHERE id = #{id}
    </update>

    <!-- 게시글 조회수 증가 -->
    <update id="increaseViewCount">
        UPDATE board SET view_count = view_count+1 WHERE id = #{id}
    </update>
</mapper>